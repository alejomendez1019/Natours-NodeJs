{"mappings":"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","sources":["public/js/mapbox.js","public/js/alerts.js","public/js/login.js","public/js/updateSettings.js","public/js/stripe.js","public/js/index.js"],"sourcesContent":["export const displayMap = (locations) => {\r\n  mapboxgl.accessToken =\r\n    'pk.eyJ1IjoiYWxlam90ZWlsdXIiLCJhIjoiY2xkYXhhYjc1MG44dDNwcWtoYmtjOGNhbyJ9.QRj3MxrunRljHxhgesW1-A';\r\n  var map = new mapboxgl.Map({\r\n    container: 'map',\r\n    style: 'mapbox://styles/alejoteilur/cldbxnwus000201ldltwfnyxr',\r\n    scrollZoom: false,\r\n\r\n    //center: [-118.113491, 34.111745],\r\n    //zoom: 4,\r\n    //interactive: false,\r\n  });\r\n\r\n  const bounds = new mapboxgl.LngLatBounds();\r\n\r\n  locations.forEach((loc) => {\r\n    // Create marker\r\n    const el = document.createElement('div');\r\n    el.className = 'marker';\r\n\r\n    // Add marker\r\n    new mapboxgl.Marker({\r\n      element: el,\r\n      anchor: 'bottom',\r\n    })\r\n      .setLngLat(loc.coordinates)\r\n      .addTo(map);\r\n\r\n    //Add popup\r\n    new mapboxgl.Popup({\r\n      offset: 30,\r\n      focusAfterOpen: false,\r\n    })\r\n      .setLngLat(loc.coordinates)\r\n      .setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`)\r\n      .addTo(map);\r\n\r\n    // Extend map bounds to include current location\r\n    bounds.extend(loc.coordinates);\r\n  });\r\n\r\n  map.fitBounds(bounds, {\r\n    padding: {\r\n      top: 200,\r\n      bottom: 150,\r\n      left: 100,\r\n      right: 100,\r\n    },\r\n  });\r\n};\r\n","export const hideAlert = () => {\r\n  const el = document.querySelector('.alert');\r\n  //Si existe el elemento, se mueve al contenedor padre y luego elimina el elemento hijo\r\n  if (el) el.parentElement.removeChild(el);\r\n};\r\n\r\n// type is 'success' or 'error'\r\nexport const showAlert = (type, msg) => {\r\n  hideAlert();\r\n  const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\r\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\r\n  window.setTimeout(hideAlert, 5000);\r\n};\r\n","//import axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\n//FORMA DE EXOPORTAR EN JAVASCRIPT, NO NODEJS\r\nexport const login = async (email, password) => {\r\n  try {\r\n    const res = await axios({\r\n      method: 'POST',\r\n      url: '/api/v1/users/login',\r\n      data: {\r\n        email,\r\n        password,\r\n      },\r\n    });\r\n    if (res.data.status === 'success') {\r\n      showAlert('success', 'Logged in successfully!');\r\n      window.setTimeout(() => {\r\n        location.assign('/');\r\n      }, 1500);\r\n    }\r\n  } catch (err) {\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n};\r\n\r\nexport const logout = async () => {\r\n  try {\r\n    const res = await axios({\r\n      method: 'GET',\r\n      url: '/api/v1/users/logout',\r\n    });\r\n    if ((res.data.status = 'success')) location.reload(true);\r\n  } catch (err) {\r\n    showAlert('error', 'Error logging out! Try again.');\r\n  }\r\n};\r\n","//import axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\n//type is either 'password' or 'data'\r\nexport const updateSettings = async (data, type) => {\r\n  try {\r\n    const url = type === 'password' ? '/api/v1/users/updateMyPassword' : '/api/v1/users/updateMe';\r\n\r\n    const res = await axios({\r\n      method: 'PATCH',\r\n      url,\r\n      data,\r\n    });\r\n    if (res.data.status === 'success') {\r\n      showAlert('success', `${type.toUpperCase()} updated successfully!`);\r\n    }\r\n  } catch (err) {\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n};\r\n","//import axios from 'axios';\r\nimport { showAlert } from './alerts';\r\nconst stripe = Stripe(\r\n  'pk_test_51MVoNgAu0EOkJj1fAnu8I8XRfQ5gaHFrKdzTfcuDzd9SB1ZZfYoAVmQ3NDYlobKRYklaNlHNZjyxkxFKteZh9Nh700cP5ndttR'\r\n);\r\n\r\nexport const bookTour = async (tourId) => {\r\n  try {\r\n    const session = await axios(`/api/v1/bookings/checkout-session/${tourId}`);\r\n    // 2) Create checkout form + charge credit card\r\n    await stripe.redirectToCheckout({\r\n      sessionId: session.data.session.id,\r\n    });\r\n    // 3) Create booking on server\r\n  } catch (err) {\r\n    showAlert('error', err);\r\n  }\r\n  // 1) Get checkout session from API\r\n};\r\n","import 'regenerator-runtime/runtime.js';\r\nimport { displayMap } from './mapbox';\r\nimport { login, logout } from './login';\r\nimport { updateSettings } from './updateSettings';\r\nimport { bookTour } from './stripe';\r\n//ESTE ARCHIVO ES PARA OBTENER DATOS DEL DOM Y LUEGO DELEGAR LA ACCION\r\n\r\n//DOM ELEMENTS\r\nconst mapBox = document.getElementById('map');\r\nconst loginForm = document.querySelector('.form--login');\r\nconst logOutBtn = document.querySelector('.nav__el--logout');\r\nconst userDataForm = document.querySelector('.form-user-data');\r\nconst userPasswordForm = document.querySelector('.form-user-password');\r\nconst bookBtn = document.getElementById('book-tour');\r\n\r\n//DELEGATION\r\n//Esto se hace para eliminar el error de que no se encuentra el elemento\r\nif (mapBox) {\r\n  const locations = JSON.parse(mapBox.dataset.locations);\r\n  displayMap(locations);\r\n}\r\n\r\nif (loginForm) {\r\n  loginForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const email = document.getElementById('email').value;\r\n    const password = document.getElementById('password').value;\r\n    login(email, password);\r\n  });\r\n}\r\n\r\nif (logOutBtn) logOutBtn.addEventListener('click', logout);\r\n\r\nif (userDataForm) {\r\n  userDataForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const form = new FormData();\r\n    form.append('name', document.getElementById('name').value);\r\n    form.append('email', document.getElementById('email').value);\r\n    form.append('photo', document.getElementById('photo').files[0]);\r\n    //Axios automaticamente va a enviar el formdata como un form normal\r\n    updateSettings(form, 'data');\r\n  });\r\n}\r\n\r\nif (userPasswordForm) {\r\n  userPasswordForm.addEventListener('submit', async (e) => {\r\n    e.preventDefault();\r\n    document.querySelector('.btn--save-password').textContent = 'Updating...';\r\n    const passwordCurrent = document.getElementById('password-current').value;\r\n    const password = document.getElementById('password').value;\r\n    const passwordConfirm = document.getElementById('password-confirm').value;\r\n    await updateSettings({ passwordCurrent, password, passwordConfirm }, 'password');\r\n\r\n    document.querySelector('.btn--save-password').textContent = 'Save password';\r\n    document.getElementById('password-current').value = '';\r\n    document.getElementById('password').value = '';\r\n    document.getElementById('password-confirm').value = '';\r\n  });\r\n}\r\n\r\nif (bookBtn) {\r\n  bookBtn.addEventListener('click', (e) => {\r\n    e.target.textContent = 'Processing...';\r\n    //Al llamar los datos que provienen del html en javascript automaticamente se convierte el - en camelCase\r\n    const { tourId } = e.target.dataset;\r\n    bookTour(tourId);\r\n  });\r\n}\r\n"],"names":["$0ef72175715aaa03$export$4c5dd147b21b9176","locations","mapboxgl","accessToken","map","Map","container","style","scrollZoom","bounds","LngLatBounds","forEach","loc","el","document","createElement","className","Marker","element","anchor","setLngLat","coordinates","addTo","Popup","offset","focusAfterOpen","setHTML","day","description","extend","fitBounds","padding","top","bottom","left","right","$74a372fa936378b4$export$516836c6a9dfc573","querySelector","parentElement","removeChild","$74a372fa936378b4$export$de026b00723010c1","type","msg","markup","insertAdjacentHTML","window","setTimeout","$062fbb26d835ba83$export$596d806903d1f59e","async","email","password","axios","method","url","data","status","location","assign","err","response","message","$97aa3c94ee1bb721$export$f558026a994b6051","toUpperCase","$6a58eacb5c168bd7$var$stripe","Stripe","$6a58eacb5c168bd7$export$8d5bdbf26681c0c2","tourId","session","redirectToCheckout","sessionId","id","$b015e757e508f687$var$mapBox","getElementById","$b015e757e508f687$var$loginForm","$b015e757e508f687$var$logOutBtn","$b015e757e508f687$var$userDataForm","$b015e757e508f687$var$userPasswordForm","$b015e757e508f687$var$bookBtn","JSON","parse","dataset","addEventListener","e","preventDefault","value","reload","form","FormData","append","files","textContent","passwordCurrent","passwordConfirm","target"],"version":3,"file":"index.js.map","sourceRoot":"../../../"}